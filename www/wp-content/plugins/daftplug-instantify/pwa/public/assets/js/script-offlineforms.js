var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var OfflineForm=function(){function OfflineForm(element){var _this=this;_classCallCheck(this,OfflineForm),this.form=element,this.id=element.id,this.action=element.action,this.data={},navigator.onLine?window.addEventListener("load",(function(){return _this.checkStorage()})):this.form.addEventListener("submit",(function(e){return _this.handleSubmit(e)}))}return _createClass(OfflineForm,[{key:"handleSubmit",value:function handleSubmit(e){var stored;e.preventDefault(),this.getFormData(),this.storeData()&&(jQuery.toast({title:"Your data was saved and will be submitted once you come back online",duration:3e3,position:"bottom"}),this.form.reset())}},{key:"storeData",value:function storeData(){if("undefined"!=typeof Storage){var entry={time:(new Date).getTime(),data:this.data};return localStorage.setItem(this.id,JSON.stringify(entry)),!0}return!1}},{key:"sendData",value:function sendData(){var _this2=this;jQuery.ajax({url:this.action,type:"POST",data:this.data}).done((function(data){localStorage.removeItem(_this2.id),_this2.form.reset()})).fail((function(data,textStatus,xhr){console.log("error",data.status)}))}},{key:"checkStorage",value:function checkStorage(){if("undefined"!=typeof Storage){var item=localStorage.getItem(this.id),entry=item&&JSON.parse(item);if(entry){var now,day,sent;if((new Date).getTime()-864e5>entry.time)return void localStorage.removeItem(this.id);this.data=entry.data,this.sendData()&&jQuery.toast({title:"Your offline saved data was successfully submitted",duration:3e3,position:"bottom"})}}}},{key:"getFormData",value:function getFormData(){var field=void 0,i=void 0,data={};if("object"===_typeof(this.form)&&"FORM"===this.form.nodeName){var len=this.form.elements.length;for(i=0;i<len;i+=1)(field=this.form.elements[i]).name&&!field.disabled&&"file"!==field.type&&"reset"!==field.type&&"submit"!==field.type&&(data[field.name]=field.value||"")}this.data=data}}]),OfflineForm}();