jQuery((function(){"use strict";var daftplugAdmin=jQuery('.daftplugAdmin[data-daftplug-plugin="daftplug_instantify"]'),optionName=daftplugAdmin.attr("data-daftplug-plugin"),objectName=window[optionName+"_admin_js_vars"];function handleScheduleProgress(timeleft,timetotal,$element){var percentLeft=100*timeleft/timetotal,year=Math.floor(timeleft/31556926),month=Math.floor(timeleft/2628e3),day=Math.floor(timeleft/86400),hour=Math.floor(timeleft/3600),minute=Math.floor(timeleft/60),second=Math.floor(timeleft),leftTime=[];if(year>0?leftTime.push(year,"Year"+(year>1?"s":"")):month>0?leftTime.push(month,"Month"+(month>1?"s":"")):day>0?leftTime.push(day,"Day"+(day>1?"s":"")):hour>0?leftTime.push(hour,"Hour"+(hour>1?"s":"")):minute>0?leftTime.push(minute,"Minute"+(minute>1?"s":"")):second>0?leftTime.push(second,"Second"+(second>1?"s":"")):(leftTime.push("","Sending"),setTimeout((function(){$element.parent().fadeOut("fast")}),2e3)),percentLeft>50){var deg=90-360*timeleft/timetotal;$element.css("background-image","linear-gradient("+deg+"deg, transparent 50%, #83a9fe 50%),linear-gradient(90deg, #83a9fe 50%, transparent 50%)")}else{var deg=-90-360*timeleft/timetotal;$element.css("background-image","linear-gradient("+deg+"deg, transparent 50%, #fff 50%),linear-gradient(90deg, #83a9fe 50%, transparent 50%)")}$element.find(".daftplugAdminScheduleProgress_numbers").html(leftTime[0]),$element.find(".daftplugAdminScheduleProgress_words").html(leftTime[1]),timeleft>0&&setTimeout((function(){handleScheduleProgress(timeleft-.005,timetotal,$element)}),5)}daftplugAdmin.find(".daftplugAdminSettings_form").on("submit",(function(e){e.preventDefault();var action=optionName+"_generate_launch_screens",canvas=document.createElement("canvas");canvas.width=2048,canvas.height=2732;var image=new Image;image.src=jQuery("#pwaIcon").attr("data-attach-url"),image.onload=function(){var ctx=canvas.getContext("2d");ctx.fillStyle=jQuery("#pwaBackgroundColor").val(),ctx.fillRect(0,0,canvas.width,canvas.height),ctx.drawImage(image,canvas.width/2-image.width/2,canvas.height/2-image.height/2);var launchScreen=canvas.toDataURL("image/png");jQuery.ajax({url:ajaxurl,type:"POST",data:{action:action,launchScreen:launchScreen},beforeSend:function(){},success:function(response,textStatus,jqXhr){},complete:function(){},error:function(jqXhr,textStatus,errorThrown){}})}})),daftplugAdmin.on("click",".daftplugAdminTable_action.-send, .daftplugAdminButton.-sendNotification",(function(e){var self=jQuery(this),openPopup=self.attr("data-open-popup"),popup=daftplugAdmin.find('[data-popup="'+openPopup+'"]'),subscription=self.attr("data-subscription"),form=popup.find(".daftplugAdminSendPush_form"),pushSegmentSelect=form.find("#pushSegment"),pushSegmentDropdown=form.find('.daftplugAdminInputSelect_dropdown[data-name="pushSegment"]'),pushSegmentList=form.find('.daftplugAdminInputSelect_list[data-name="pushSegment"]');pushSegmentSelect.val(subscription),pushSegmentList.find(".daftplugAdminInputSelect_option.-selected").removeClass("-selected"),pushSegmentList.find('.daftplugAdminInputSelect_option[data-value="'+subscription+'"]').addClass("-selected"),pushSegmentDropdown.attr("data-value",subscription).text(pushSegmentList.find(".daftplugAdminInputSelect_option.-selected").find(".daftplugAdminInputSelect_text").text())})),daftplugAdmin.on("click",".daftplugAdminPage_subpage.-pushnotifications .daftplugAdminTable_action.-remove",(function(e){var self=jQuery(this),row=self.closest(".daftplugAdminTable_row"),action=optionName+"_handle_subscription",method="remove",endpoint=self.attr("data-subscription");jQuery.ajax({url:ajaxurl,dataType:"text",type:"POST",data:{action:action,method:method,endpoint:endpoint},beforeSend:function(){row.addClass("-disabled")},success:function(response,textStatus,jqXhr){row.remove()},complete:function(){},error:function(jqXhr,textStatus,errorThrown){row.remove()}})})),daftplugAdmin.on("input paste","#subscribersFilter",(function(e){var self,searchPhrase=jQuery(this).val();searchPhrase=jQuery.trim(searchPhrase).replace(/ +/g," ").toLowerCase(),daftplugAdmin.find("tbody").find(".daftplugAdminTable_row").show().filter((function(e){var a;return-1===jQuery(this).text().replace(/\s+/g," ").toLowerCase().indexOf(searchPhrase)})).hide()})),daftplugAdmin.find(".daftplugAdminSendPush_form").on("submit",(function(e){e.preventDefault();var self=jQuery(this),scheduledCardFieldset=daftplugAdmin.find(".daftplugAdminFieldset_schedules"),popup=daftplugAdmin.find('[data-popup="pushModal"]'),button=self.find(".daftplugAdminButton.-submit"),responseText=self.find(".daftplugAdminField_response"),action=optionName+"_send_notification",nonce=self.attr("data-nonce"),pushImage=self.find("#pushImage"),pushIcon=self.find("#pushIcon"),inputs=self.find(":input"),notificationData=self.daftplugSerialize();jQuery.ajax({url:ajaxurl,dataType:"text",type:"POST",data:{action:action,nonce:nonce,notificationData:notificationData},beforeSend:function(){button.addClass("-loading")},success:function(response,textStatus,jqXhr){var response;if((response=JSON.parse(response)).success){if(button.addClass("-success"),setTimeout((function(){button.removeClass("-loading -success")}),1500),responseText.css("color","#4073FF").html(response.data.message).fadeIn("fast").delay(3e3).fadeOut("fast",(function(){responseText.empty().show()})),self.trigger("reset"),pushImage.val("").removeClass("-hasFile").removeAttr("data-attach-url"),pushIcon.val("").removeClass("-hasFile").removeAttr("data-attach-url"),self.find(".daftplugAdminMiniFieldset_close").trigger("click"),inputs.trigger("change"),response.data.scheduled){scheduledCardFieldset.append(`\n                            <span class="daftplugAdminSchedule">\n                                <div class="daftplugAdminScheduleProgress" data-timeleft="${response.data.timeleft}" data-timetotal="${response.data.timetotal}">\n                                    <div class="daftplugAdminScheduleProgress_circle"></div>\n                                    <div class="daftplugAdminScheduleProgress_timer">\n                                        <div class="daftplugAdminScheduleProgress_numbers"></div>\n                                        <div class="daftplugAdminScheduleProgress_words"></div>\n                                    </div>\n                                </div>\n                                <div class="daftplugAdminSchedule_meta">\n                                    <div class="daftplugAdminSchedule_date">${response.data.date}</div>\n                                    <div class="daftplugAdminSchedule_time">${response.data.time}</div>\n                                    <div class="daftplugAdminSchedule_actions -actions">\n                                        <span class="daftplugAdminSchedule_action -send" data-action="send" data-time="${response.data.datetime}" data-args='${JSON.stringify(response.data.args)}' data-tooltip="Send Now" data-tooltip-flow="bottom">\n                                            <svg class="daftplugAdminSchedule_icon -iconSend">\n                                                <use href="#iconBell"></use>\n                                            </svg>\n                                        </span>\n                                        <span class="daftplugAdminSchedule_action -edit" data-action="edit" data-time="${response.data.datetime}" data-args='${JSON.stringify(response.data.args)}' data-tooltip="Edit" data-tooltip-flow="bottom" data-open-popup="scheduledPushModal">\n                                            <svg class="daftplugAdminSchedule_icon -iconEdit">\n                                                <use href="#iconEdit"></use>\n                                            </svg>\n                                        </span>\n                                        <span class="daftplugAdminSchedule_action -remove" data-action="remove" data-time="${response.data.datetime}" data-args='${JSON.stringify(response.data.args)}' data-tooltip="Remove" data-tooltip-flow="bottom">\n                                            <svg class="daftplugAdminSchedule_icon -iconRemove">\n                                                <use href="#iconRemove"></use>\n                                            </svg>\n                                        </span>\n                                    </div>\n                                </div>\n                            </span>\n                        `).css({padding:"10px 0",margin:"25px"});var progressElm=scheduledCardFieldset.find(".daftplugAdminScheduleProgress:last"),timeleft,timetotal;handleScheduleProgress(response.data.timeleft,response.data.timetotal,progressElm)}setTimeout((function(){popup.removeClass("-active")}),2e3)}else button.addClass("-fail"),setTimeout((function(){button.removeClass("-loading -fail")}),1500),responseText.css("color","#FF3A3A").html(response.data.message).fadeIn("fast")},complete:function(){},error:function(jqXhr,textStatus,errorThrown){button.addClass("-fail"),setTimeout((function(){button.removeClass("-loading -fail")}),1500),responseText.css("color","#FF3A3A").html("Push notification failed.").fadeIn("fast"),console.log(jqXhr)}})})),daftplugAdmin.find('.daftplugAdminPopup[data-popup^="pwaOverlaysType"]').each((function(e){var self=jQuery(this),type=self.attr("data-popup").replace("pwaOverlaysType",""),preview=self.find(".pwaOverlaysType"+type+"Preview"),close=preview.find(".pwaOverlaysType"+type+"Preview_close"),title=preview.find(".pwaOverlaysType"+type+"Preview_title"),text=preview.find(".pwaOverlaysType"+type+"Preview_text"),notnow=preview.find(".pwaOverlaysType"+type+"Preview_notnow"),button=preview.find(".pwaOverlaysType"+type+"Preview_button"),textField=self.find("#pwaOverlaysType"+type+"Message"),bgColorField=self.find("#pwaOverlaysType"+type+"BackgroundColor"),textColorField=self.find("#pwaOverlaysType"+type+"TextColor");textField.on("input change",(function(e){text.text(textField.val())})),bgColorField.on("input change",(function(e){preview.css("background",bgColorField.val()),button.css("color",bgColorField.val())})),textColorField.on("input change",(function(e){"Header"==type?(title.add(text).css("color",textColorField.val()),close.css("stroke",textColorField.val())):"Snackbar"==type?title.add(text).css("color",textColorField.val()):text.add(notnow).css("color",textColorField.val()),button.css("background",textColorField.val())}))})),daftplugAdmin.find(".daftplugAdminButton.-preview").on("click",(function(e){e.preventDefault();var self=jQuery(this),form=self.closest("form"),pushTitle=form.find("#pushTitle").val(),pushBody=form.find("#pushBody").val(),pushImage=form.find("#pushImage").attr("data-attach-url"),pushIcon=form.find("#pushIcon").attr("data-attach-url");"Notification"in window?"default"===Notification.permission?Notification.requestPermission().then(permission=>{"granted"===permission?new Notification(pushTitle,{body:pushBody,image:pushImage,icon:pushIcon,tag:"renotify",renotify:!0}):self.attr({"data-tooltip":"Sending notifications are not allowed in your browser","data-tooltip-flow":"top"})}):"denied"===Notification.permission?self.attr({"data-tooltip":"Sending notifications are not allowed in your browser","data-tooltip-flow":"top"}):new Notification(pushTitle,{body:pushBody,image:pushImage,icon:pushIcon,tag:"renotify",renotify:!0}):self.attr({"data-tooltip":"Notifications are not supported in your browser","data-tooltip-flow":"top"})})),daftplugAdmin.find(".daftplugAdminFieldset_schedules").each((function(e){var self=jQuery(this);0==self.children().length&&self.css({padding:"0",margin:"0"})})),daftplugAdmin.find(".daftplugAdminSchedule").each((function(e){var self,progressElm=jQuery(this).find(".daftplugAdminScheduleProgress"),timeleft,timetotal;handleScheduleProgress(progressElm.attr("data-timeleft"),progressElm.attr("data-timetotal"),progressElm)})),daftplugAdmin.on("click",".daftplugAdminPage_subpage.-pushnotifications .daftplugAdminSchedule_action.-edit",(function(e){var self=jQuery(this),notificationData=JSON.parse(self.attr("data-args")).notificationData,popup=daftplugAdmin.find('[data-popup="scheduledPushModal"]'),form=popup.find(".daftplugAdminScheduledPush_form"),inputs=form.find(":input"),addFieldButton=form.find(".daftplugAdminButton.-addField"),miniFieldsetClose=form.find(".daftplugAdminMiniFieldset_close"),pushSegment=form.find("#pushSegment"),pushSegmentList=form.find('.daftplugAdminInputSelect_list[data-name="pushSegment"]'),pushSegmentDropdown=form.find('.daftplugAdminInputSelect_dropdown[data-name="pushSegment"]'),pushTitle=form.find("#pushTitle"),pushBody=form.find("#pushBody"),pushImage=form.find("#pushImage"),pushUrl=form.find("#pushUrl"),pushIcon=form.find("#pushIcon"),pushScheduledDatetime=form.find("#pushScheduledDatetime");pushSegment.val(notificationData.pushSegment),pushSegmentList.find(".daftplugAdminInputSelect_option.-selected").removeClass("-selected"),pushSegmentList.find('.daftplugAdminInputSelect_option[data-value="'+notificationData.pushSegment+'"]').addClass("-selected"),pushSegmentDropdown.attr("data-value",notificationData.pushSegment).text(pushSegmentList.find(".daftplugAdminInputSelect_option.-selected").find(".daftplugAdminInputSelect_text").text()),pushTitle.val(notificationData.pushTitle),pushBody.val(notificationData.pushBody),pushUrl.val(notificationData.pushUrl),pushScheduledDatetime.val(notificationData.pushScheduledDatetime),form.attr({"data-time":self.attr("data-time"),"data-args":self.attr("data-args")}),notificationData.pushImage&&wp.media.attachment(notificationData.pushImage).fetch().then((function(data){var image=wp.media.attachment(notificationData.pushImage).get("url");pushImage.val(notificationData.pushImage).attr("data-attach-url",image).addClass("-hasFile").next().find("image").attr("href",image)})),notificationData.pushIcon&&wp.media.attachment(notificationData.pushIcon).fetch().then((function(data){var image=wp.media.attachment(notificationData.pushIcon).get("url");pushIcon.val(notificationData.pushIcon).attr("data-attach-url",image).addClass("-hasFile").next().find("image").attr("href",image)})),"on"==notificationData.pushActionButton1&&(addFieldButton.trigger("click"),form.find("#pushActionButton1Text").val(notificationData.pushActionButton1Text),form.find("#pushActionButton1Url").val(notificationData.pushActionButton1Url)),"on"==notificationData.pushActionButton2&&(addFieldButton.trigger("click"),form.find("#pushActionButton2Text").val(notificationData.pushActionButton2Text),form.find("#pushActionButton2Url").val(notificationData.pushActionButton2Url)),inputs.trigger("change"),popup.not(".daftplugAdminPopup_container").on("click",(function(e){form.trigger("reset"),inputs.trigger("change"),pushImage.add(pushIcon).val("").removeAttr("data-attach-url").removeClass("-hasFile").next().find("image").removeAttr("href"),miniFieldsetClose.trigger("click")}))})),daftplugAdmin.find(".daftplugAdminScheduledPush_form").on("submit",(function(e){e.preventDefault();var self=jQuery(this),scheduledCardFieldset=daftplugAdmin.find(".daftplugAdminFieldset_schedules"),popup=daftplugAdmin.find('[data-popup="scheduledPushModal"]'),button=self.find(".daftplugAdminButton.-submit"),responseText=self.find(".daftplugAdminField_response"),miniFieldsetClose=self.find(".daftplugAdminMiniFieldset_close"),action=optionName+"_handle_scheduled_notification",method="edit",time=self.attr("data-time"),args=self.attr("data-args"),pushImage=self.find("#pushImage"),pushIcon=self.find("#pushIcon"),inputs=self.find(":input"),notificationData=self.daftplugSerialize();jQuery.ajax({url:ajaxurl,dataType:"text",type:"POST",data:{action:action,method:"edit",time:time,args:args,notificationData:notificationData},beforeSend:function(){button.addClass("-loading")},success:function(response,textStatus,jqXhr){var response;if((response=JSON.parse(response)).data.scheduled){button.addClass("-success"),setTimeout((function(){button.removeClass("-loading -success")}),1500),responseText.css("color","#4073FF").html(response.data.message).fadeIn("fast").delay(3e3).fadeOut("fast",(function(){responseText.empty().show()})),self.trigger("reset"),pushImage.add(pushIcon).val("").removeClass("-hasFile").removeAttr("data-attach-url"),miniFieldsetClose.trigger("click"),inputs.trigger("change"),scheduledCardFieldset.append(`\n                        <span class="daftplugAdminSchedule">\n                            <div class="daftplugAdminScheduleProgress" data-timeleft="${response.data.timeleft}" data-timetotal="${response.data.timetotal}">\n                                <div class="daftplugAdminScheduleProgress_circle"></div>\n                                <div class="daftplugAdminScheduleProgress_timer">\n                                    <div class="daftplugAdminScheduleProgress_numbers"></div>\n                                    <div class="daftplugAdminScheduleProgress_words"></div>\n                                </div>\n                            </div>\n                            <div class="daftplugAdminSchedule_meta">\n                                <div class="daftplugAdminSchedule_date">${response.data.date}</div>\n                                <div class="daftplugAdminSchedule_time">${response.data.time}</div>\n                                <div class="daftplugAdminSchedule_actions -actions">\n                                    <span class="daftplugAdminSchedule_action -send" data-action="send" data-time="${response.data.datetime}" data-args='${JSON.stringify(response.data.args)}' data-tooltip="Send Now" data-tooltip-flow="bottom">\n                                        <svg class="daftplugAdminSchedule_icon -iconSend">\n                                            <use href="#iconBell"></use>\n                                        </svg>\n                                    </span>\n                                    <span class="daftplugAdminSchedule_action -edit" data-action="edit" data-time="${response.data.datetime}" data-args='${JSON.stringify(response.data.args)}' data-tooltip="Edit" data-tooltip-flow="bottom" data-open-popup="scheduledPushModal">\n                                        <svg class="daftplugAdminSchedule_icon -iconEdit">\n                                            <use href="#iconEdit"></use>\n                                        </svg>\n                                    </span>\n                                    <span class="daftplugAdminSchedule_action -remove" data-action="remove" data-time="${response.data.datetime}" data-args='${JSON.stringify(response.data.args)}' data-tooltip="Remove" data-tooltip-flow="bottom">\n                                        <svg class="daftplugAdminSchedule_icon -iconRemove">\n                                            <use href="#iconRemove"></use>\n                                        </svg>\n                                    </span>\n                                </div>\n                            </div>\n                        </span>\n                    `).css({padding:"10px 0",margin:"25px"}).find(`[data-time="${response.data.oldSchedule}"]`).closest(".daftplugAdminSchedule").remove();var progressElm=scheduledCardFieldset.find(".daftplugAdminScheduleProgress:last"),timeleft,timetotal;handleScheduleProgress(response.data.timeleft,response.data.timetotal,progressElm),setTimeout((function(){popup.removeClass("-active")}),2e3)}else button.addClass("-fail"),setTimeout((function(){button.removeClass("-loading -fail")}),1500),responseText.css("color","#FF3A3A").html(response.data.message).fadeIn("fast")},complete:function(){},error:function(jqXhr,textStatus,errorThrown){button.addClass("-fail"),setTimeout((function(){button.removeClass("-loading -fail")}),1500),responseText.css("color","#FF3A3A").html("Push notification failed.").fadeIn("fast"),console.log(jqXhr)}})})),daftplugAdmin.on("click",".daftplugAdminPage_subpage.-pushnotifications .daftplugAdminSchedule_action:not(.-edit)",(function(e){var self=jQuery(this),scheduledCardFieldset=daftplugAdmin.find(".daftplugAdminFieldset_schedules"),scheduledCard=self.closest(".daftplugAdminSchedule"),timer=scheduledCard.find(".daftplugAdminScheduleProgress_timer"),action=optionName+"_handle_scheduled_notification",method=self.attr("data-action"),time=self.attr("data-time"),args=self.attr("data-args");jQuery.ajax({url:ajaxurl,dataType:"text",type:"POST",data:{action:action,method:method,time:time,args:args},beforeSend:function(){scheduledCard.addClass("-disabled"),"send"==method&&timer.replaceWith('<div class="daftplugAdminScheduleProgress_timer">Sending</div>')},success:function(response,textStatus,jqXhr){var response;(response=JSON.parse(response)).success&&(scheduledCard.remove(),0==scheduledCardFieldset.children().length&&scheduledCardFieldset.css({padding:"0",margin:"0"}))},complete:function(){},error:function(jqXhr,textStatus,errorThrown){scheduledCard.remove(),0==scheduledCardFieldset.children().length&&scheduledCardFieldset.css({padding:"0",margin:"0"}),console.log(jqXhr)}})})),jQuery.fn.daftplugSerialize=function(){var data={};return jQuery.each(this.serializeArray(),(function(){if(data[this.name])data[this.name].push||(data[this.name]=[data[this.name]]),data[this.name].push(this.value||"");else if(this.name.includes("]")){var nestedArray=this.name.split("[").map(s=>s.replace("]","")),headName=nestedArray[0];nestedArray.shift();var nestedValue=nestedArray.reduceRight((all,item)=>({[item]:all}),this.value);data[headName]=nestedValue}else data[this.name]=this.value||""})),jQuery.each(jQuery("input[type=radio], input[type=checkbox]",this),(function(){data.hasOwnProperty(this.name)||(data[this.name]="off")})),JSON.stringify(data)}}));